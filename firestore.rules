rules_version = '2';

service cloud.firestore {
    match /databases/{database}/documents {

      // Users collection
      match /users/{userId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // User profiles
      match /userProfiles/{userId} {
        allow read: if request.auth != null;
        allow write: if request.auth != null && request.auth.uid == userId;
      }

      // User settings
      match /userSettings/{userId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // Shops - anyone can read, only owner can modify
      match /shops/{shopId} {
        allow read: if true;
        allow create: if request.auth != null;
        allow update, delete: if request.auth != null &&
                                 resource.data.ownerId == request.auth.uid;
      }

      // Shop images
      match /shopImages/{imageId} {
        allow read: if true;
        allow create: if request.auth != null;
        allow delete: if request.auth != null;
      }

      // Shop videos
      match /shopVideos/{shopId} {
        allow read: if true;
        allow write: if request.auth != null;
      }

      // Product images
      match /productImages/{imageId} {
        allow read: if true;
        allow write: if request.auth != null;
      }

      // Product reviews
      match /productReviews/{reviewId} {
        allow read: if true;
        allow create: if request.auth != null;
        allow update, delete: if request.auth != null &&
                               request.auth.uid == resource.data.userId;
      }

      // Seller reviews
      match /sellerReviews/{reviewId} {
        allow read: if true;
        allow create: if request.auth != null;
        allow update, delete: if request.auth != null &&
                               request.auth.uid == resource.data.userId;
      }

      // Test collection (for debugging)
      match /test/{document=**} {
        allow read, write: if true;
      }
    }
  }
